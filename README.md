# Проектная работа "Веб-ларек"
#### Интернет-магазин с товарами для веб-разработчиков — Web-ларёк. В нём можно посмотреть каталог товаров, добавить товары в корзину и сделать заказ.

![Image alt](/src/images/web_larek.jpg)

### Стек: **HTML, SCSS, TS, Webpack**
#### [Макет Mesto в Figma](https://www.figma.com/design/50YEgxY8IYDYj7UQu7yChb/%D0%92%D0%B5%D0%B1-%D0%BB%D0%B0%D1%80%D1%91%D0%BA?node-id=0-1&node-type=canvas&t=yeJ3BmBAja3ihMGN-0) 
#### [Публикация  сайта на сервере](https://ulyanakulbida.github.io/web-larek-frontend/).
#### Репозиторий: https://github.com/UlyanaKulbida/web-larek-frontend.git
\
Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом
- src/components/common/ — папка с общими компонентами
- src/components/model/ — папка с моделями данных
- src/components/view/ — папка с представлениями

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/types/index.ts — файл с с типами TypeScript
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и Типы данных

Интерфейс страницы (IPage)
```
  catalog: HTMLElement[] - контейнер c  карточками товаров
  counterr: number - счетчик товаров в корзине
  locked: boolean  - прокрутка страницы
```

Карточки товара (ICard)
```
  id: string  - уникальный идентификатор карточки товара
  description: string - описание товара
  image: string - URL изображения товара
  title: string - название товара
  category: string - категория товара (например, "софт-скилл", "хард-скилл")
  price?: string - цена товара. Может быть undefined, если цена не указана
  isInBasket: string - значение, указывает, добавлен ли товар в корзину
  index: string - порядковый номер товара
```

Продукт (IProduct)
```
  id: string - уникальный идентификатор продукта
  image: string - URL изображения продукта
  title: string - название продукта
  description: string - описание продукта
  category: string - категория продукта
  price: number | null - цена продукта (число, если цена не указана - null)
```

Заказ (IOrder)
```
  payment: PaymentMethod - способ оплаты. Использует тип PaymentMethod
  email: string - email покупателя
  phone: string - телефон покупателя
  address: string - адрес для доставки
  total: string | number - общая сумма заказа (строка или число)
  items: string[] - список идентификаторов товаров, которые были заказаны
```

Типы, связанные с заказом (IOrder)
```
Способ оплаты
  type PaymentMethod = 'card' | 'cash' | null

Успешное размещение заказа
  type SuccessData = { id: string; total: string }

Форма вида оплаты и адреса доставки
  type TOrderFormPayment = Pick<IOrder, 'payment' | 'address' | null>

Форма контактных данных
  type TOrderFormContacts = Pick<IOrder, 'email' | 'phone'>

объект ошибок валидации формы
  type FormErrors = Partial<Record<keyof IOrder, string>>

Валидация формы
  type TForm = { valid: boolean }
```

Данные карточек (ICardsData)
``` 
  cards: IProduct[] - массив продуктов
  getCard(cardId: string): IProduct | undefined - получение продукта по его id
  (undefined - если такого продукта нет)
```

Данные заказа (IOrderData)
``` 
  paymentInfo: TOrderFormPayment - информация о способе оплаты и адресе доставки
  contactInfo: TOrderFormContacts - контактная информация
  clearOrder(): void метод для очистки данных заказа
  clearUserContacts(): void - метод для очистки контактных данных;
  checkValidation(): boolean - метод для проверки валидности данных заказа
```

Данные корзины (IBasketData)
``` 
  cardsBasket: IProduct[] - массив продуктов, добавленных в корзину
  total: number - общая сумма товаров в корзине
  addProductBasket(product: IProduct) - добавление продукта в корзину
  deleteProductBasket(id: string): void - удаление продукта из корзины по его id
  clearBasket(): void - метод для очистки корзины
  getTotal(): number - получение общей суммы товаров в корзине
  inBasket(productId: string): boolean - проверка, находится ли товар в корзине
  getProductsBasket(): IProduct[] - получение всех продуктов в корзине
  getProductsIdInBasket(): string[] - получения всех id продуктов в корзине
```

Общая форма (IForm)
``` 
  valid: boolean - значение указывает является ли форма валидной или нет
	errors: string - строка, содержащая описание ошибок, если форма не валидна
```

Форма для контактной информации (IFormOfContact)
``` 
  email: string - поле для хранения адреса электронной почты
	phone: string - поле для хранения телефонного номера
```

Форма для данных оплаты (IFormOfPayment)
``` 
  payment: PaymentMethod | null - поле представляет собой метод оплаты
	address: string -  поле для хранения адреса
```

Отображение Успешного заказа (ISuccessView)
``` 
  total: string - итоговая сумма заказа, отображающаяся после успешного заказа
```

События клика (ICardActions)
``` 
  onClick(event: MouseEvent): void - метод для обработки клика на карточке
```

API приложения (IAppApi)
``` 
  getProducts(): Promise<IProduct[]> - получения списка продуктов,
  возвращает промис с массивом
  getProductById(id: string): Promise<IProduct> - олучения продукта по его
  идентификатору,
  возвращает промис с продуктом
  postOrder(order: IOrder): Promise<SuccessData> - размещения заказа,
  возвращает промис с данными успешного ответа 
```

## Архитектура приложения 
В архитектуре проекта используется парадигма MVP с брокером событий, код приложения разделен на следующие слои  : 

- данные (Model) - отвечают за хранение и передачу данных;
- представление (View) - отвечает за отображение данных на странице;
- презентер (Presenter) - отвечает за связь  между представлением и данными;

### Базовый код

#### Класс Api
 Класс для работы с сетью, принимает в конструктор базовый адрес сервера и  объект с заголовками HTTP запросов для взаимодействия с бэкендом сервиса.

конструктор
 - `baseUrl` - параметр содержит базовый URL  для запросов API к серверу;
 - `options` - параметр по умолчанию равен пустому объекту. Данному параметру устанавливается св-во headers - заголовок со значением, указывающий, что данные отправляемые на сервер, будут в формате JSON. Это св-во используется для указания дополнительных  заголовков HTTP запросов (если содержит какие-либо заголовки, они будут добавлены к объекту заголовков, в противном случае будет добавлен только заголовок по умолчанию).

методы
 - `handleResponse` -  обработка ответа с сервера (преобразование тела ответа в JSON-объект);
 - `GET` - получение данных с сервера к указанному URI;
 - `POST` - отправка данных на сервер к указанному URI.


#### Класс EventEmitter
Используется в презентере как класc-посредник между слоями представление (View) и данные (Model) для обработки событий и в слоях приложения для генерации событий. Реализует интерфейс IEvents, в параметры конструктора ничего не передается

методы
 - `on` - установка обработчика на событие01
 - `off` - снятие обработчика с события
 - `emit` - инициирование события с данными
 - `onAll` - слушание всех событий
 - `offAll` - сброс всех обработчиков
 - `trigger` - создание коллбек триггера, генерирующего событие при вызове


#### Класс Component
Используется для создания компонент интерфейса пользователя, управляющих DOM-элементами и наследуется всеми классами из слоя представления

конструктор
 - container -  DOM-элемент куда будет помещен нужный компонент.

### Слой данных
#### Класс CardData
Отвечает за хранение и логику работы с данными карточек продуктов. Конструктор класса  инициализирует массив карт и вызывает конструктор родительского класса Model и инициализирует пустой массив _cards.\

свойства:
```
 - _cards - массив объектов карточек продуктов;
```
 методы взаимодействия с данными:
```
 - getCardId(cardId: string) - возвращает карточку по ее id;
```
#### Класс BasketData
Отвечает за хранение и логику работы с данными карточек продуктов в корзине.
В конструкторе класса вызывается метод, который очищает корзину при создании экземпляра класса.\

свойства:
```
protected _cardsBasket - массив товаров в корзине
protected _total - общая сумма всех товаров в корзине
```
 методы взаимодействия с данными:
```
 - addProductBasket(product: IProduct) - добавляет продукт в начало списка товаров в корзине
 - deleteProductBasket(id: string)- удаляет продукт из списка товаров в корзине
 - clearBasket()- очищает корзину от товаров
 - getTotal(): number
 - inBasket(idCard: string) - проверяет продукт уже выбран/не выбран 
 - getProductsBasket() - возвращает массив продуктов корзине;
 - getProductsIdBasket() - возвращает массив id продуктов в корзине, цена которых больше нуля
 
```

#### Класс OrderData
Класс класс отвечает за управление данными заказа, включая информацию об оплате и контактные данные, а также за валидацию этих данных и обработку ошибок. Конструктор принимает объект events, это позволяет классу использовать системы событий для оповещения о различных изменениях.\

свойства:
```
 - paymentData - свойство для хранения платежной информации
 - contactData - свойство для хранения контактной информации
 - order - свойство для хранения данных заказа
 - formErrors - свойство для хранения ошибок в форме
```
 методы взаимодействия с данными:
```
 - checkValidation() - валидирует поля ввода в форме оплаты и контактных данных
 - getOrderData() - сохраняет поля в форме адреса доставки
 - clearOrder() - метод для очистки платежной информации
 - clearContacts() - метод для очистки контактной информации
```

### Слой представления
Классы этого слоя отвечают за отображение в нутри контейнера (DOM - элемент)передаваемых в них данных.

#### Класс Page
Класс расширяетинтерфейс IPage, используется для отображения главной страницы: логотипа, каталога товаров, иконки корзины и количество товаров в ней. Страница блокируется при открытии модального окна. Конструктор класса инициализирует элементы страницы и добавляет обработчик события клика на кнопку корзины.

данные полей:
```
 - _catalog - свойство для хранения элемента каталога
 - _wrapper - свойство для хранения элемента обертки страницы
 - _basket - свойство для хранения кнопки корзины
 - _counter - свойство для хранения счетчика корзины
```

#### Класс Modal
Отвечает за работу с модальными окнами. Конструктор класса кнопку закрытия и контент модального окна, а также добавляет обработчики событий клика на кнопку закрытия и контент окна.

данные полей:
```
 - closeButton: HTMLButtonElement - DOM элемент кнопки закрытия попапа
 - content: HTMLElement - DOM элемент с контентом папапа
```
методы взаимодействия с данными:
```
 - open - открывает попап
 - close - закрывает попап
 - render  - отрисовывает данные в попапе
```

#### Класс Form
Отвечает за работу с формой заказа. Конструктор инициализирует кнопку отправки, поля ввода и элемент ошибок и добавляет слушатели событий.

данные полей:
```
 - _inputs - массив HTML элементов ввода
 - _submit - DOM элемент кнопки отправки данных формы
 - _errors - DOM элемент отображения ошибки валидации формы
```
методы взаимодействия с данными:
```
 render - принимает объект data и извлекает значение valid, устанавливает его через сеттер valid. Вызывает метод render родительского класса Component с оставшимися данными
```

#### Класс Success
Отвечает за работу с попапом успешного заказа.

данные полей:
```
 - totalPrice: number - общей стоимость товаров;
 - btnSuccessActions: HTMLButtonElement - кнопка перехода на главную страницу.
``` 
методы взаимодействия с данными:
```
 - setPriceTotal(value: number) - отображает общую сумму в попапе успешного заказа.
```

#### Класс Card
Класс описывает компоненту карточки товара, расширяет интерфейс IProduct.  Используется для отображения карточки в галлереи товаров, в модальном окне просмотра информации товара  и просмотре карточки товара и корзине.\
данные полей:
```
 - id: string -  идентификатор карточки продукта;
 - _image: HTMLElement - элемент с изображение мпродукта;
 - _title: HTMLElement - заголовок с названием продукта;
 - _description: HTMLElement - элемент с описанием продукта;
 - _category: HTMLElement - элемент с указанием категории продукта;
 - _price: HTMLElement - элемент со значением стоимости товара;
 - addButton: HTMLButtonElement - кнопка добавления товара в корзину.
 - _index
```
методы взаимодействия с данными:
```
Класс Card содержит множество сеттеров, которые позволяют обновлять различные свойства карточки: идентификатор карточки, текст заголовка карточки, изображение карточки, описания карточки, категорию карточки, цену карточки, текст кнопки, индекс карточки
```

#### Класс FormPayment
Отвечает за работу с формой вида оплаты и адреса доставки в попапе. Конструктор класса вызывает конструктор родительского класса и инициализирует свойства класса. Он также вызывает методы для инициализиации элементов и обработчики событий.\

константы:
```
 - CLASS_BUTTON_ACTIVE - класс, который будет добавлен к кнопке, когда она активна
 - SELECTOR_BUTTONS - селектор, который используется для выбора контейнера кнопок
 - SELECTOR_ADDRESS - селектор, который используется для выбора поля адреса
 - SELECTOR_CARD - селектор, который используется для выбора кнопки оплаты картой
 - SELECTOR_CASH - селектор, который используется для выбора кнопки оплаты наличными
 - SELECTOR_ORDER_BUTTON - селектор, который используется для выбора кнопки отправки заказа
``` 
данные полей:
```
 - containerButtons - контейнер кнопок.
 - paymentCard - кнопка оплаты картой.
 - paymentCash - кнопка оплаты наличными.
 - _address - поле адреса.
 - orderButton - кнопка отправки заказа.
 - _payment - текущий метод оплаты.
``` 
методы взаимодействия с данными:
```
 - paymentClick - обрабатывает клик на кнопке оплаты
 - initElements -  инициализирует элементы класса.
 - initEventListeners - инициализирует обработчики событий класса
```

#### Класс FormContacts
Отвечает за работу с формой контактных данных в попапе. Конструктор класса вызывает конструктор родительского класса Form и инициализирует свойства класса. Он также вызывает метод initElements, чтобы инициализировать элементы.

константы:
```
 - SELECTOR_EMAIL: строковое значение, представляющее селектор для элемента электронной почты
 - SELECTOR_PHONE: строковое значение, представляющее селектор для элемента телефона
``` 
данные полей:
```
 - inputEmail - инпут для ввода e-mail
 - inputPhone - инпут для ввода телефона
``` 
методы взаимодействия с данными:
```
Класс FormPayment содержит  сеттеры и геттеры предоставляют доступ к значениям полей _email и _phone: устанавливают значение поля телефона, возвращают значение поля телефона, устанавливают значение поля электронной почты, возвращают значение поля электронной почты.
```

### Слой коммуникации
#### Класс AppApi
Наследует класс Api и предоставаляет методы  взаимодействия с бэкендом сервиса для работы с продуктами и заказами. Конструктор класса принимает три параметра: cdn, baseUrl, и options. baseUrl и options передаются в конструктор базового класса Api, а cdn сохраняется в локальном свойстве класса.

данные полей:
```
 - ccdn: string - строка, представляющая базовый URL для CDN (Content Delivery Network);
 - baseUrl: string - базовый URL для API;
 - options?: RequestInit - дополнительные параметры для HTTP-запросов, которые передаются в базовый класс Api через super
```
методы взаимодействия с данными:
```
 - getProducts - получение списка продуктов с сервера. Он делает GET-запрос на эндпоинт product, обрабатывает полученный ответ, добавляя к каждому продукту полный URL изображения (используя cdn), и возвращает обновленный список продуктов.
 - getProductById  - получение информации о конкретном продукте по его идентификатор. 
 - postOrder - отправка заказа на сервер. Делает POST-запрос с данными заказа и возвращает данные об успешной отправке заказа, если она произошла.
```

## Взаимодействие компонентов
Взаимодействие осуществляется с помощью событий которые генерирует брокер событий и обработчиков этих событий, описанных в `index.ts`

События изменения данных:

- `cards:changed` - обновление списка продуктов
- `basket:changed` - обновление счетчика продуктов в корзине

Взаимодействие пользователя с интерфейсом

События корзины:
- `basket:delete` - удаление продукта из корзины
- `basket:submit` - начало процесса оформления заказа
- `basket:open` - открытие корзины

События оплаты:
- `order:submit` - начало процесса ввода контактных данных
- `order:valid` - валидация данных оплаты
- `formErrors:change` -  обработка ошибок в формах

События контактных данных  покупателя:
- `contact:submit` - отправка контактных данных в заказе
- `contacts:valid` - валидация контактных данных

События попапа:
- `modal:open` - открытие модального окна;
- `modal:close` - закрытие модального окна.
- `preview:selected` - открытие предварительного просмотра продукта
- `preview:submit` - добавление или удаление продукта из корзины

События успешного заказа:
- `success:submit` - закрытие попапа, возврат на главную страницу после успешного заказа
